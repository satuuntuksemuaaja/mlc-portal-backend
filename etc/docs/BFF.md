# BFF Integration


Data Alignment


Connections and Finding the Organisation


Security: Either a configurable token that can be easily updated or JWT.


## BFF Database Changes


### Organisation
Create a new Table
```
CREATE TABLE "organisation" (
    "id" int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "key" string,
    "name" string,
    "logo" string
);
```

// To be discussed - An organisation will have one or many accounts
// We don't want them to be regular users on mlc side but might need some way of identifying them...
```
CREATE TABLE "organisationuser" (
);

```

### Invitation
Add Organisation Id so we can identify the organisation related to the invitation
FK link to org or just leave as loose key.


### Connection
I think we can just track connections back to an organisation through the organisationuser table.


### Event
Potentially Add Organisation Id
FK link but can be null


### Voucher
Add Organisation Id - FK link to org or just leave as loose key.
Add Customer Email, pre-allocated voucher to the customer.




## BFF API's for Partner Portal

### Organisation

`POST /pp/organisation`
Create an organisation
Request
```
{
    "key" : "ACME"
    "name" : "ACME Co"
    "logo" : "bae64 encoded logo"
}
```

Response
```
{
    "key" : "ACME"
    "name" : "ACME Co"
    "logo" : "bae64 encoded logo"
}
```


 `PUT /pp/organisation`
 Create or updates an organisation
 Request & Response as above
 

`GET /pp/organisation/<key>`
Get an organisation
Response as above
404 if not found




### Invitation
`POST /pp/invitation`
Creates an Invitation, similar to the client version.

Additional:
 - Create a new voucher linked to the organisation and the email
 - Links the invitation to the organisation

Request
```
{
    "orgkey" : "ACME"
    "subscriptionlength" : "12" // months
    // the rest will be the same as the client invitation request
}
```

Response
I think it will be the same as the client version, possibly returning the voucher code as well.


`DELETE /pp/invitation/<token>`
If the invitation has not been claimed then delete.
Delete or invalidate the voucher.
```
{
    "orgkey" : "ACME"
    "recipient" : "recipientemail"
}
```


### Items
`POST /pp/item/shared`
Creates a new Event: "you_received_share"

Request 
```
{
  "sender_name" : "Acme Org",
  "orgkey" :"ACME",
  "user_id" :"connection.other.id" // or users email and bff can find user??
  "item_id" : "item.id" // share id?
}
```


**POST /pp/message/shared**
Creates a new Event: "you_received_message" *NEW*

Request 
As above


### Subscriptions

`POST /pp/subscription/extend`
Extends a users voucher subscription.

Request 
```
{
  "email" : "users email"
  "subscriptionlength" : "12" // months
}
```


## Partner Portal API's for BFF

### Invitations
`POST /bff/invitation/rejected`
User rejects the client invitation, bff communicates the rejection back to the partner portal
PP: Creates a notification, Marks user as cancelled


`POST /bff/invitation/connected`
User accepts the client invitation, bff communicates the connection back to the partner portal
PP: Creates a notification, Sends Email, Marks user as active, Marks subscription as active


### Items 
`POST /bff/item/shared`
User shares an item with an organisation, bff communicates the share back to the partner portal
PP: Creates a notification, Sends Email

BFF should not send email 'An Item has been shared with you'


`POST /bff/message/shared`
User sends a message to the organisation, bff communicates the share back to the partner portal
PP: Creates a notification, Sends Email

BFF should not send email 'An Item has been shared with you'


## MLC Client API's

### Organisation
Gets the details for an organisation
`GET /org/<key>`
`GET /org/photo/<key>`


### Me
/me/
  -> Send details of any organisation that owns the subscription
Or How do we connect an organisation through the connections?


### Subscription
Send details of any organisation that owns the subscription




Other Changes
---------

